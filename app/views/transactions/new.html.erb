<% @code_position = current_user.code_pool.sample %>
<div class="row">
	<div class="columns large-12 text-center">
		<h2><%= @product.name %></h2>
		<h3 class="columns large-6 large-centered small-12 medium-8 medium-centered">
			<% if @product.image.present? %>
	      <% if @product.image_processing? %>
	        <br><h4 class="text-center">Processing image...</h4><br>
	      <% elsif %>
          <%= image_tag(@product.image.url(:default), class: "text-center").html_safe %>
	      <% else %>
		      <img src="http://placehold.it/1000x1000&amp;text=Image not available">
		    <% end %>
		  <% end %>
		</h3>
		<h3>
			<span id="purchase_cost">
				<%= @product.credits %>
			</span>
			 credits
		</h3>

		<div class="authform registration large-4 large-centered columns">
			<%= simple_form_for [@product, @transaction] do |f| %>
			  <%= f.error_notification %>

			  <div class="form-actions">
			    <%= f.input :quantity, input_html: { id: "item_quantity", min: 1 } %>
			    <%= f.input :code_position, as: :hidden, 
			    										input_html: { value: "#{ @code_position }" } %>
			    <%= f.input :security_code, label: "Enter Security Code ##{ @code_position }",
			    											 input_html: { maxlength: 6 } %>
			  </div>

			  <div class="form-actions">
			    <%= f.button :submit, 'Verify & Buy', 
			    											class: 'btn-large btn-warning success radius', 
			    												 id: 'item_submit' %>
			  </div>
			<% end %>
		</div>
	</div>
</div>